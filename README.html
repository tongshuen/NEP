<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEP 服务器 - 新一代电子邮件协议</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        h1, h2, h3 {
            color: #2c3e50;
            margin-top: 24px;
        }
        h1 {
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        code {
            background: #f5f5f5;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
        pre {
            background: #f8f8f8;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .note {
            background: #e7f5fe;
            border-left: 4px solid #3498db;
            padding: 10px;
            margin: 15px 0;
        }
        .warning {
            background: #fff3e0;
            border-left: 4px solid #ffa726;
            padding: 10px;
            margin: 15px 0;
        }
        .command {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        .license {
            background: #f9f9f9;
            border: 1px solid #ddd;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>NEP 服务器</h1>
    <p>新一代电子邮件协议 (New Email Protocol) 服务器实现</p>
    
    <div class="note">
        <strong>版本对应：</strong>
        <table>
            <tr>
                <th>组件</th>
                <th>代码版本</th>
                <th>文档版本</th>
            </tr>
            <tr>
                <td>NEP核心</td>
                <td>v0.1.0</td>
                <td>v0.1.0</td>
            </tr>
            <tr>
                <td>NEP-T</td>
                <td>v0.1.0</td>
                <td>v0.1.0</td>
            </tr>
            <tr>
                <td>NEP-H</td>
                <td>v0.1.0</td>
                <td>v0.1.0</td>
            </tr>
        </table>
        <strong>最后验证：</strong> 2025-10-05
    </div>

    <h2>目录</h2>
    <ul>
        <li><a href="#overview">项目概述</a></li>
        <li><a href="#features">功能特性</a></li>
        <li><a href="#protocols">协议模式</a></li>
        <li><a href="#quickstart">快速开始</a></li>
        <li><a href="#installation">安装指南</a></li>
        <li><a href="#configuration">配置说明</a></li>
        <li><a href="#api">API 文档</a></li>
        <li><a href="#storage">存储后端</a></li>
        <li><a href="#conversion">协议转换</a></li>
        <li><a href="#contributing">贡献指南</a></li>
        <li><a href="#license">GPLv3 许可证</a></li>
    </ul>

    <h2 id="overview">项目概述</h2>
    <p>NEP (New Email Protocol) 是一个设计用于替代传统电子邮件协议(SMTP/POP3/IMAP)的新一代协议，具有以下优势：</p>
    <ul>
        <li><strong>更轻量</strong>：二进制协议设计，减少传输数据量</li>
        <li><strong>更高效</strong>：减少协议交互次数，降低延迟</li>
        <li><strong>更安全</strong>：强制 TLS 加密，现代认证机制</li>
        <li><strong>更简单</strong>：单一协议处理所有操作</li>
    </ul>

    <h2 id="features">功能特性</h2>
    <ul>
        <li>支持三种协议模式：
            <ul>
                <li><strong>NEP</strong>：标准二进制协议 (端口2525)</li>
                <li><strong>NEP-T</strong>：兼容传统SMTP协议 (端口2526)</li>
                <li><strong>NEP-H</strong>：基于HTTPS的Web界面 (端口8080)</li>
            </ul>
        </li>
        <li>多存储后端支持：
            <ul>
                <li><code>file</code>：文件存储 (默认)</li>
                <li><code>mysql</code>：MySQL数据库</li>
                <li><code>redis</code>：Redis键值存储</li>
            </ul>
        </li>
        <li>完善的用户权限系统：
            <ul>
                <li>普通用户：管理自己的邮件和账户</li>
                <li>管理员：通过管理面板(端口8000)管理所有用户</li>
            </ul>
        </li>
        <li>邮件速率限制</li>
        <li>自动协议转换</li>
        <li>中英文双语界面</li>
    </ul>

    <h2 id="protocols">协议模式</h2>
    <table>
        <tr>
            <th>协议</th>
            <th>端口</th>
            <th>认证方式</th>
            <th>数据格式</th>
        </tr>
        <tr>
            <td>NEP</td>
            <td>2525</td>
            <td>API Token</td>
            <td>二进制 (MessagePack)</td>
        </tr>
        <tr>
            <td>NEP-T</td>
            <td>2526</td>
            <td>SMTP AUTH (PLAIN/LOGIN)</td>
            <td>MIME格式文本</td>
        </tr>
        <tr>
            <td>NEP-H</td>
            <td>8080</td>
            <td>OAuth2/JWT</td>
            <td>JSON</td>
        </tr>
        <tr>
            <td>管理面板</td>
            <td>8000</td>
            <td>Session Cookie</td>
            <td>HTML/JSON</td>
        </tr>
    </table>

    <h2 id="quickstart">快速开始</h2>
    <div class="command">
        # 安装依赖 (建议使用虚拟环境)<br>
        pip install -r requirements.txt<br>
        <br>
        # 复制配置文件<br>
        cp config/default.yaml config/production.yaml<br>
        <br>
        # 启动服务器<br>
        python main.py --config config/production.yaml
    </div>

    <h2 id="installation">安装指南</h2>
    <h3>系统要求</h3>
    <ul>
        <li>Python 3.8+</li>
        <li>Redis 6.0+ (可选)</li>
        <li>MySQL 8.0+ (可选)</li>
    </ul>

    <h3>多文件版 (生产环境推荐)</h3>
    <div class="command">
        # 安装MySQL依赖 (如使用MySQL存储)<br>
        pip install mysql-connector-python<br>
        <br>
        # 安装Redis依赖 (如使用Redis存储)<br>
        pip install redis<br>
        <br>
        # 启动时指定配置<br>
        python main.py --config config/production.yaml
    </div>

    <h3>单文件版 (测试用途)</h3>
    <div class="command">
    <p>暂未完成</p>
    </div>

    <h2 id="configuration">配置说明</h2>
    <p>完整配置示例 (<code>config/production.yaml</code>):</p>
    <pre>
# 日志配置
logging:
  level: INFO  # DEBUG|INFO|WARNING|ERROR
  file: /var/log/nep/server.log

# NEP核心协议
nep:
  host: "0.0.0.0"
  port: 2525
  rate_limits:
    send: 100/hour  # 每小时发送限制
    fetch: 500/hour # 每小时获取限制

# NEP-T传统协议
nept:
  host: "0.0.0.0"
  port: 2526
  allow_plain_auth: false  # 禁用明文认证

# NEP-H Web界面
neph:
  host: "0.0.0.0"
  port: 8080
  cors_origins: ["https://yourdomain.com"]

# 管理面板
web:
  host: "0.0.0.0"
  port: 8000
  secret_key: "changeme_to_random_string"

# 存储配置
storage:
  type: "file"  # file|mysql|redis
  
  # 文件存储配置
  file:
    path: "/var/lib/nep/data"
    emails_dir: "emails"
    users_file: "users.json"
  
  # MySQL配置
  mysql:
    host: "localhost"
    port: 3306
    user: "nep_user"
    password: "secure_password"
    database: "nep_db"
    table_prefix: "nep_"
  
  # Redis配置
  redis:
    host: "localhost"
    port: 6379
    db: 0
    password: ""
    key_prefix: "nep:"
    </pre>

    <h2 id="api">API 文档</h2>
    <h3>NEP 二进制协议</h3>
    <p>协议帧格式 (MessagePack):</p>
    <pre>
{
  "type": "send|list|fetch|update",
  "session_id": "uuid_string",
  "data": { ... }  # 操作相关数据
}
    </pre>

    <h3>NEP-H REST API</h3>
    <table>
        <tr>
            <th>端点</th>
            <th>方法</th>
            <th>请求示例</th>
            <th>响应示例</th>
        </tr>
        <tr>
            <td><code>/api/auth</code></td>
            <td>POST</td>
            <td><pre>{"email":"user@example.com", "password":"..."}</pre></td>
            <td><pre>{"token":"jwt_token"}</pre></td>
        </tr>
        <tr>
            <td><code>/api/mails</code></td>
            <td>POST</td>
            <td><pre>{
  "to": ["recipient@example.com"],
  "subject": "Hello",
  "body": "Test content"
}</pre></td>
            <td><pre>{"message_id": "msg_123"}</pre></td>
        </tr>
        <tr>
            <td><code>/api/mails/{id}</code></td>
            <td>PUT</td>
            <td><pre>{"read": true}</pre></td>
            <td><pre>{"status": "updated"}</pre></td>
        </tr>
    </table>

    <h2 id="storage">存储后端</h2>
    <h3>文件存储</h3>
    <p>默认存储方式，目录结构：</p>
    <pre>
data/
├── emails/
│   ├── user1@example.com/
│   │   ├── inbox/
│   │   │   ├── msg1.json
│   │   │   └── msg2.json
│   │   └── sent/
│   └── user2@example.com/
└── users.json  # 用户数据库
    </pre>

    <h3>MySQL表结构</h3>
    <pre>
CREATE TABLE `nep_users` (
  `id` VARCHAR(36) PRIMARY KEY,
  `email` VARCHAR(255) UNIQUE,
  `password_hash` VARCHAR(255),
  `created_at` TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE `nep_emails` (
  `id` VARCHAR(36) PRIMARY KEY,
  `user_id` VARCHAR(36),
  `mailbox` VARCHAR(20),
  `message_data` JSON,
  `flags` JSON,
  FOREIGN KEY (`user_id`) REFERENCES `nep_users`(`id`)
);
    </pre>

    <h2 id="conversion">协议转换</h2>
    <p>自动转换流程：</p>
    <pre>
NEP客户端 → [二进制协议] → NEP服务器 ↔ [协议转换] ↔ SMTP服务器
                      ↑
                 [JSON/HTTP]
                      ↓
                Web浏览器客户端
    </pre>

    <h2 id="contributing">贡献指南</h2>
    <ol>
        <li> Fork 项目仓库</li>
        <li> 创建特性分支 (<code>git checkout -b feature/new-feature</code>)</li>
        <li> 提交更改 (<code>git commit -am 'Add new feature'</code>)</li>
        <li> 推送到分支 (<code>git push origin feature/new-feature</code>)</li>
        <li> 创建 Pull Request</li>
    </ol>

    <div class="note">
        <strong>贡献者列表：</strong>
        <ul>
            <li>童顺</li>
        </ul>
    </div>

    <h2 id="license">LICENSE</h2>
    <div class="license">
    <p>许可证： <a href="LICENSE">LICENSE</a> 文件</p>

    <div class="warning">
        <strong>免责声明：</strong>还在开发，本软件使用者需自行承担风险。
    </div>
</body>
</html>
